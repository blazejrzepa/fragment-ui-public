{
  "name": "command-palette",
  "type": "registry:block",
  "dependencies": [
    "react",
    "react-dom"
  ],
  "files": [
    {
      "path": "components/ui/command-palette.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport {\n  Command,\n  CommandDialog,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n  CommandSeparator,\n  CommandShortcut,\n} from \"./command\";\nimport { Button } from \"./button\";\n\nexport interface CommandPaletteAction {\n  id: string;\n  label: string;\n  keywords?: string[];\n  shortcut?: string;\n  icon?: React.ReactNode;\n  onSelect?: () => void;\n  group?: string;\n  children?: CommandPaletteAction[]; // Nested commands\n}\n\nexport interface CommandPaletteProps {\n  actions: CommandPaletteAction[];\n  trigger?: React.ReactNode;\n  placeholder?: string;\n  emptyText?: string;\n  showRecentCommands?: boolean;\n  maxRecentCommands?: number;\n  recentCommandsStorageKey?: string;\n}\n\nexport function CommandPalette({\n  actions,\n  trigger,\n  placeholder = \"Type a command or search...\",\n  emptyText = \"No results found.\",\n  showRecentCommands = true,\n  maxRecentCommands = 5,\n  recentCommandsStorageKey = \"command-palette-recent\",\n}: CommandPaletteProps) {\n  const [open, setOpen] = React.useState(false);\n  const [recentCommands, setRecentCommands] = React.useState<string[]>([]);\n\n  // Load recent commands from localStorage\n  React.useEffect(() => {\n    if (showRecentCommands && typeof window !== \"undefined\") {\n      const stored = localStorage.getItem(recentCommandsStorageKey);\n      if (stored) {\n        try {\n          setRecentCommands(JSON.parse(stored));\n        } catch {\n          // Invalid JSON, ignore\n        }\n      }\n    }\n  }, [showRecentCommands, recentCommandsStorageKey]);\n\n  // Save recent commands to localStorage\n  const saveRecentCommand = React.useCallback(\n    (commandId: string) => {\n      if (!showRecentCommands) return;\n      setRecentCommands((prev) => {\n        const filtered = prev.filter((id) => id !== commandId);\n        const updated = [commandId, ...filtered].slice(0, maxRecentCommands);\n        if (typeof window !== \"undefined\") {\n          localStorage.setItem(recentCommandsStorageKey, JSON.stringify(updated));\n        }\n        return updated;\n      });\n    },\n    [showRecentCommands, maxRecentCommands, recentCommandsStorageKey]\n  );\n\n  React.useEffect(() => {\n    const down = (e: KeyboardEvent) => {\n      if (e.key === \"k\" && (e.metaKey || e.ctrlKey)) {\n        e.preventDefault();\n        setOpen((open) => !open);\n      }\n    };\n\n    document.addEventListener(\"keydown\", down);\n    return () => document.removeEventListener(\"keydown\", down);\n  }, []);\n\n  // Flatten nested commands\n  const flattenActions = React.useCallback((actions: CommandPaletteAction[]): CommandPaletteAction[] => {\n    const flattened: CommandPaletteAction[] = [];\n    actions.forEach((action) => {\n      if (action.children && action.children.length > 0) {\n        // Add parent as a category\n        flattened.push({ ...action, children: undefined });\n        // Add children with parent prefix\n        action.children.forEach((child) => {\n          flattened.push({\n            ...child,\n            label: `${action.label} > ${child.label}`,\n            group: action.group || child.group,\n          });\n        });\n      } else {\n        flattened.push(action);\n      }\n    });\n    return flattened;\n  }, []);\n\n  const groupedActions = React.useMemo(() => {\n    const flattened = flattenActions(actions);\n    const groups: Record<string, CommandPaletteAction[]> = {};\n    flattened.forEach((action) => {\n      const group = action.group || \"General\";\n      if (!groups[group]) {\n        groups[group] = [];\n      }\n      groups[group].push(action);\n    });\n    return groups;\n  }, [actions, flattenActions]);\n\n  // Get recent command actions\n  const recentCommandActions = React.useMemo(() => {\n    if (!showRecentCommands || recentCommands.length === 0) return [];\n    const flattened = flattenActions(actions);\n    const allActionsMap = new Map(flattened.map((a) => [a.id, a]));\n    return recentCommands\n      .map((id) => allActionsMap.get(id))\n      .filter((action): action is CommandPaletteAction => action !== undefined);\n  }, [actions, recentCommands, showRecentCommands, flattenActions]);\n\n  return (\n    <>\n      {trigger ? (\n        <div onClick={() => setOpen(true)}>{trigger}</div>\n      ) : (\n        <Button\n          variant=\"outline\"\n          onClick={() => setOpen(true)}\n          className=\"w-full justify-between\"\n        >\n          Search...{\" \"}\n          <span className=\"text-xs text-[color:var(--color-fg-muted)]\">\n            âŒ˜K\n          </span>\n        </Button>\n      )}\n      <CommandDialog open={open} onOpenChange={setOpen}>\n        <CommandInput placeholder={placeholder} />\n        <CommandList>\n          <CommandEmpty>{emptyText}</CommandEmpty>\n          {showRecentCommands && recentCommandActions.length > 0 && (\n            <CommandGroup heading=\"Recent\">\n              {recentCommandActions.map((action) => (\n                <CommandItem\n                  key={action.id}\n                  value={`${action.label} ${action.keywords?.join(\" \") || \"\"}`}\n                  onSelect={() => {\n                    action.onSelect?.();\n                    saveRecentCommand(action.id);\n                    setOpen(false);\n                  }}\n                >\n                  {action.icon}\n                  <span>{action.label}</span>\n                  {action.shortcut && (\n                    <CommandShortcut>{action.shortcut}</CommandShortcut>\n                  )}\n                </CommandItem>\n              ))}\n              <CommandSeparator />\n            </CommandGroup>\n          )}\n          {Object.entries(groupedActions).map(([groupName, groupActions]) => (\n            <CommandGroup key={groupName} heading={groupName}>\n              {groupActions.map((action) => (\n                <CommandItem\n                  key={action.id}\n                  value={`${action.label} ${action.keywords?.join(\" \") || \"\"}`}\n                  onSelect={() => {\n                    action.onSelect?.();\n                    saveRecentCommand(action.id);\n                    setOpen(false);\n                  }}\n                >\n                  {action.icon}\n                  <span>{action.label}</span>\n                  {action.shortcut && (\n                    <CommandShortcut>{action.shortcut}</CommandShortcut>\n                  )}\n                </CommandItem>\n              ))}\n            </CommandGroup>\n          ))}\n        </CommandList>\n      </CommandDialog>\n    </>\n  );\n}\n\n\n"
    },
    {
      "path": "components/ui/command.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport { Command as CommandPrimitive } from \"cmdk\";\nimport { Dialog, DialogContent, DialogTitle, DialogDescription } from \"./dialog\";\nimport * as VisuallyHiddenPrimitive from \"@radix-ui/react-visually-hidden\";\nimport clsx from \"clsx\";\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={clsx(\n      \"flex h-full w-full flex-col overflow-hidden rounded-[var(--radius-md)] bg-[color:var(--color-surface-1)] text-[color:var(--color-fg-base)]\",\n      className\n    )}\n    {...props}\n  />\n));\nCommand.displayName = CommandPrimitive.displayName;\n\nconst CommandDialog = ({\n  children,\n  ...props\n}: React.ComponentPropsWithoutRef<typeof Dialog>) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0\">\n        <VisuallyHiddenPrimitive.Root>\n          <DialogTitle>Command Palette</DialogTitle>\n          <DialogDescription>\n            Search for commands and actions. Use arrow keys to navigate, Enter to select.\n          </DialogDescription>\n        </VisuallyHiddenPrimitive.Root>\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-[color:var(--color-fg-muted)] [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-1 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\">\n    <CommandPrimitive.Input\n      ref={ref}\n      className={clsx(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-[color:var(--color-fg-muted)] disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n));\n\nCommandInput.displayName = CommandPrimitive.Input.displayName;\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={clsx(\n      \"max-h-[300px] overflow-y-auto overflow-x-hidden\",\n      className\n    )}\n    {...props}\n  />\n));\n\nCommandList.displayName = CommandPrimitive.List.displayName;\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className={clsx(\"py-6 text-center text-sm\", className)}\n    {...props}\n  />\n));\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName;\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={clsx(\n      \"overflow-hidden p-1 text-[color:var(--color-fg-base)] [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-[color:var(--color-fg-muted)]\",\n      className\n    )}\n    {...props}\n  />\n));\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName;\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={clsx(\"-mx-1 h-px bg-[color:var(--color-fg-muted)]\", className)}\n    {...props}\n  />\n));\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName;\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={clsx(\n      \"relative flex cursor-default select-none items-center rounded-[var(--radius-sm)] px-2 py-1.5 text-sm outline-none aria-selected:bg-[color:var(--color-surface-2)] aria-selected:text-[color:var(--color-fg-base)] data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  />\n));\n\nCommandItem.displayName = CommandPrimitive.Item.displayName;\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={clsx(\n        \"ml-auto text-xs tracking-widest text-[color:var(--color-fg-muted)]\",\n        className\n      )}\n      {...props}\n    />\n  );\n};\nCommandShortcut.displayName = \"CommandShortcut\";\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n};\n\n\n"
    }
  ]
}