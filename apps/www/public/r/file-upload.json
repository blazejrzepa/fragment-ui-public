{
  "name": "file-upload",
  "type": "registry:block",
  "dependencies": [
    "react",
    "react-dom"
  ],
  "files": [
    {
      "path": "components/ui/file-upload.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport clsx from \"clsx\";\nimport { Upload, X, File, Image, FileText, CheckCircle2, AlertCircle } from \"lucide-react\";\nimport { Button } from \"./button\";\nimport { Progress } from \"./progress\";\n\nexport interface FileUploadFile {\n  file: File;\n  id: string;\n  preview?: string;\n  progress?: number;\n  error?: string;\n}\n\nexport interface FileUploadProps {\n  onUpload?: (files: File[]) => void | Promise<void>;\n  onFileChange?: (files: FileUploadFile[]) => void;\n  accept?: string | string[];\n  multiple?: boolean;\n  maxSize?: number; // bytes\n  maxFiles?: number;\n  disabled?: boolean;\n  className?: string;\n  showPreview?: boolean;\n  showProgress?: boolean;\n}\n\nconst formatFileSize = (bytes: number): string => {\n  if (bytes === 0) return \"0 Bytes\";\n  const k = 1024;\n  const sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\"];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return Math.round(bytes / Math.pow(k, i) * 100) / 100 + \" \" + sizes[i];\n};\n\nconst getFileIcon = (file: File): React.ReactNode => {\n  if (file.type.startsWith(\"image/\")) {\n    return <Image className=\"h-5 w-5\" />;\n  }\n  return <FileText className=\"h-5 w-5\" />;\n};\n\nexport const FileUpload = React.forwardRef<HTMLDivElement, FileUploadProps>(\n  function FileUpload(\n    {\n      onUpload,\n      onFileChange,\n      accept,\n      multiple = false,\n      maxSize,\n      maxFiles,\n      disabled = false,\n      className,\n      showPreview = true,\n      showProgress = false,\n      ...props\n    },\n    ref\n  ) {\n    const [files, setFiles] = React.useState<FileUploadFile[]>([]);\n    const [isDragging, setIsDragging] = React.useState(false);\n    const [errors, setErrors] = React.useState<string[]>([]);\n    const fileInputRef = React.useRef<HTMLInputElement>(null);\n    const dropZoneRef = React.useRef<HTMLDivElement>(null);\n\n    const acceptString = React.useMemo(() => {\n      if (!accept) return undefined;\n      if (Array.isArray(accept)) return accept.join(\",\");\n      return accept;\n    }, [accept]);\n\n    const validateFile = React.useCallback(\n      (file: File): string | null => {\n        // Check file size\n        if (maxSize && file.size > maxSize) {\n          return `File size exceeds maximum of ${formatFileSize(maxSize)}`;\n        }\n\n        // Check file type\n        if (acceptString) {\n          const acceptedTypes = acceptString.split(\",\").map((t) => t.trim());\n          const fileType = file.type;\n          const fileName = file.name.toLowerCase();\n\n          const isAccepted = acceptedTypes.some((type) => {\n            if (type.startsWith(\".\")) {\n              // Extension check\n              return fileName.endsWith(type.toLowerCase());\n            }\n            // MIME type check\n            if (type.endsWith(\"/*\")) {\n              return fileType.startsWith(type.slice(0, -2));\n            }\n            return fileType === type;\n          });\n\n          if (!isAccepted) {\n            return `File type not accepted. Accepted types: ${acceptString}`;\n          }\n        }\n\n        return null;\n      },\n      [maxSize, acceptString]\n    );\n\n    const processFiles = React.useCallback(\n      (newFiles: FileList | File[]) => {\n        const fileArray = Array.from(newFiles);\n        const newErrors: string[] = [];\n\n        // Check max files limit\n        if (maxFiles && files.length + fileArray.length > maxFiles) {\n          newErrors.push(`Maximum ${maxFiles} file(s) allowed`);\n          setErrors(newErrors);\n          return;\n        }\n\n        const processedFiles: FileUploadFile[] = [];\n\n        fileArray.forEach((file) => {\n          const error = validateFile(file);\n          if (error) {\n            newErrors.push(`${file.name}: ${error}`);\n            return;\n          }\n\n          const fileId = `${file.name}-${file.size}-${Date.now()}`;\n          const fileData: FileUploadFile = {\n            file,\n            id: fileId,\n            progress: showProgress ? 0 : undefined,\n          };\n\n          // Generate preview for images\n          if (showPreview && file.type.startsWith(\"image/\")) {\n            const reader = new FileReader();\n            reader.onload = (e) => {\n              setFiles((prev) =>\n                prev.map((f) =>\n                  f.id === fileId ? { ...f, preview: e.target?.result as string } : f\n                )\n              );\n            };\n            reader.readAsDataURL(file);\n          }\n\n          processedFiles.push(fileData);\n        });\n\n        if (newErrors.length > 0) {\n          setErrors(newErrors);\n        }\n\n        if (processedFiles.length > 0) {\n          const updatedFiles = [...files, ...processedFiles];\n          setFiles(updatedFiles);\n          onFileChange?.(updatedFiles);\n\n          // Call onUpload if provided\n          if (onUpload) {\n            const uploadPromise = onUpload(processedFiles.map((f) => f.file));\n            if (uploadPromise && showProgress) {\n              // Simulate progress if onUpload returns a promise\n              processedFiles.forEach((fileData) => {\n                let progress = 0;\n                const interval = setInterval(() => {\n                  progress += 10;\n                  if (progress >= 100) {\n                    clearInterval(interval);\n                    setFiles((prev) =>\n                      prev.map((f) =>\n                        f.id === fileData.id ? { ...f, progress: 100 } : f\n                      )\n                    );\n                  } else {\n                    setFiles((prev) =>\n                      prev.map((f) =>\n                        f.id === fileData.id ? { ...f, progress } : f\n                      )\n                    );\n                  }\n                }, 100);\n\n                uploadPromise\n                  .then(() => {\n                    clearInterval(interval);\n                    setFiles((prev) =>\n                      prev.map((f) =>\n                        f.id === fileData.id ? { ...f, progress: 100 } : f\n                      )\n                    );\n                  })\n                  .catch((error) => {\n                    clearInterval(interval);\n                    setFiles((prev) =>\n                      prev.map((f) =>\n                        f.id === fileData.id\n                          ? { ...f, error: error.message || \"Upload failed\" }\n                          : f\n                      )\n                    );\n                  });\n              });\n            }\n          }\n        }\n      },\n      [files, maxFiles, validateFile, showPreview, showProgress, onUpload, onFileChange]\n    );\n\n    const handleDragOver = React.useCallback(\n      (e: React.DragEvent) => {\n        e.preventDefault();\n        e.stopPropagation();\n        if (!disabled) {\n          setIsDragging(true);\n        }\n      },\n      [disabled]\n    );\n\n    const handleDragLeave = React.useCallback(\n      (e: React.DragEvent) => {\n        e.preventDefault();\n        e.stopPropagation();\n        setIsDragging(false);\n      },\n      []\n    );\n\n    const handleDrop = React.useCallback(\n      (e: React.DragEvent) => {\n        e.preventDefault();\n        e.stopPropagation();\n        setIsDragging(false);\n\n        if (disabled) return;\n\n        const droppedFiles = e.dataTransfer.files;\n        if (droppedFiles.length > 0) {\n          if (!multiple && droppedFiles.length > 1) {\n            setErrors([\"Only one file allowed\"]);\n            return;\n          }\n          processFiles(droppedFiles);\n        }\n      },\n      [disabled, multiple, processFiles]\n    );\n\n    const handleFileInputChange = React.useCallback(\n      (e: React.ChangeEvent<HTMLInputElement>) => {\n        const selectedFiles = e.target.files;\n        if (selectedFiles && selectedFiles.length > 0) {\n          if (!multiple && selectedFiles.length > 1) {\n            setErrors([\"Only one file allowed\"]);\n            return;\n          }\n          processFiles(selectedFiles);\n        }\n        // Reset input value to allow selecting the same file again\n        if (fileInputRef.current) {\n          fileInputRef.current.value = \"\";\n        }\n      },\n      [multiple, processFiles]\n    );\n\n    const handleRemoveFile = React.useCallback(\n      (fileId: string) => {\n        setFiles((prev) => {\n          const updated = prev.filter((f) => f.id !== fileId);\n          onFileChange?.(updated);\n          return updated;\n        });\n      },\n      [onFileChange]\n    );\n\n    const handleClick = React.useCallback(() => {\n      if (!disabled && fileInputRef.current) {\n        fileInputRef.current.click();\n      }\n    }, [disabled]);\n\n    return (\n      <div ref={ref} className={clsx(\"w-full\", className)} {...props}>\n        {/* Drop Zone */}\n        <div\n          ref={dropZoneRef}\n          onDragOver={handleDragOver}\n          onDragLeave={handleDragLeave}\n          onDrop={handleDrop}\n          onClick={handleClick}\n          className={clsx(\n            \"relative border-2 border-dashed rounded-lg p-8 text-center cursor-pointer transition-colors\",\n            isDragging\n              ? \"border-[color:var(--color-brand-primary)] bg-[color:var(--color-surface-2)]\"\n              : \"border-[color:var(--color-border-base)] bg-[color:var(--color-surface-1)] hover:border-[color:var(--color-brand-primary)] hover:bg-[color:var(--color-surface-2)]\",\n            disabled && \"opacity-60 cursor-not-allowed\"\n          )}\n          role=\"button\"\n          tabIndex={disabled ? -1 : 0}\n          aria-label=\"File upload drop zone\"\n          onKeyDown={(e) => {\n            if ((e.key === \"Enter\" || e.key === \" \") && !disabled) {\n              e.preventDefault();\n              handleClick();\n            }\n          }}\n        >\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            accept={acceptString}\n            multiple={multiple}\n            disabled={disabled}\n            onChange={handleFileInputChange}\n            className=\"hidden\"\n            aria-label=\"File input\"\n          />\n          <Upload\n            className={clsx(\n              \"mx-auto h-12 w-12 mb-4\",\n              isDragging\n                ? \"text-[color:var(--color-brand-primary)]\"\n                : \"text-[color:var(--color-fg-muted)]\"\n            )}\n          />\n          <p className=\"text-sm font-medium text-[color:var(--color-fg-base)] mb-1\">\n            {isDragging ? \"Drop files here\" : \"Click to upload or drag and drop\"}\n          </p>\n          <p className=\"text-xs text-[color:var(--color-fg-muted)]\">\n            {acceptString && `Accepted: ${acceptString}`}\n            {maxSize && ` • Max size: ${formatFileSize(maxSize)}`}\n            {maxFiles && ` • Max files: ${maxFiles}`}\n          </p>\n        </div>\n\n        {/* Error Messages */}\n        {errors.length > 0 && (\n          <div className=\"mt-4 p-3 rounded-md bg-[color:var(--color-status-error-bg)] border border-[color:var(--color-status-error-border)]\">\n            {errors.map((error, index) => (\n              <div key={index} className=\"flex items-center gap-2 text-sm text-[color:var(--color-status-error-fg)]\">\n                <AlertCircle className=\"h-4 w-4 flex-shrink-0\" />\n                <span>{error}</span>\n              </div>\n            ))}\n          </div>\n        )}\n\n        {/* File List */}\n        {files.length > 0 && (\n          <div className=\"mt-4 space-y-2\">\n            {files.map((fileData) => (\n              <div\n                key={fileData.id}\n                className=\"flex items-center gap-3 p-3 rounded-md border border-[color:var(--color-border-base)] bg-[color:var(--color-surface-1)]\"\n              >\n                {/* Preview or Icon */}\n                {showPreview && fileData.preview ? (\n                  <img\n                    src={fileData.preview}\n                    alt={fileData.file.name}\n                    className=\"h-12 w-12 object-cover rounded\"\n                  />\n                ) : (\n                  <div className=\"h-12 w-12 flex items-center justify-center rounded bg-[color:var(--color-surface-2)]\">\n                    {getFileIcon(fileData.file)}\n                  </div>\n                )}\n\n                {/* File Info */}\n                <div className=\"flex-1 min-w-0\">\n                  <p className=\"text-sm font-medium text-[color:var(--color-fg-base)] truncate\">\n                    {fileData.file.name}\n                  </p>\n                  <p className=\"text-xs text-[color:var(--color-fg-muted)]\">\n                    {formatFileSize(fileData.file.size)}\n                  </p>\n                  {fileData.error && (\n                    <p className=\"text-xs text-[color:var(--color-status-error-fg)] mt-1\">\n                      {fileData.error}\n                    </p>\n                  )}\n                  {showProgress && fileData.progress !== undefined && (\n                    <div className=\"mt-2\">\n                      <Progress value={fileData.progress} className=\"h-1\" />\n                    </div>\n                  )}\n                </div>\n\n                {/* Remove Button */}\n                {!fileData.error && (\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      handleRemoveFile(fileData.id);\n                    }}\n                    disabled={disabled}\n                    aria-label={`Remove ${fileData.file.name}`}\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                )}\n                {fileData.error && (\n                  <AlertCircle className=\"h-5 w-5 text-[color:var(--color-status-error-fg)] flex-shrink-0\" />\n                )}\n                {fileData.progress === 100 && !fileData.error && (\n                  <CheckCircle2 className=\"h-5 w-5 text-[color:var(--color-status-success-fg)] flex-shrink-0\" />\n                )}\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    );\n  }\n);\n\nFileUpload.displayName = \"FileUpload\";\n\n"
    }
  ]
}