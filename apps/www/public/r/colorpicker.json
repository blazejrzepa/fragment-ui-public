{
  "name": "colorpicker",
  "type": "registry:component",
  "dependencies": [
    "react",
    "react-dom",
    "@fragment_ui/ui"
  ],
  "files": [
    {
      "path": "components/ui/ColorPicker.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport { HexColorPicker, RgbColorPicker, HslColorPicker } from \"react-colorful\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"./popover\";\nimport { Button } from \"./button\";\nimport { Input } from \"./input\";\nimport clsx from \"clsx\";\n\ntype ColorFormat = \"hex\" | \"rgb\" | \"hsl\";\n\nexport interface ColorPickerProps {\n  value?: string;\n  onChange?: (color: string) => void;\n  format?: ColorFormat;\n  showPresets?: boolean;\n  presets?: string[];\n  showAlpha?: boolean;\n  className?: string;\n  disabled?: boolean;\n}\n\nconst defaultPresets = [\n  \"#000000\",\n  \"#FFFFFF\",\n  \"#FF0000\",\n  \"#00FF00\",\n  \"#0000FF\",\n  \"#FFFF00\",\n  \"#FF00FF\",\n  \"#00FFFF\",\n  \"#808080\",\n  \"#FFA500\",\n  \"#800080\",\n  \"#FFC0CB\",\n  \"#A52A2A\",\n  \"#000080\",\n];\n\nfunction hexToRgb(hex: string): { r: number; g: number; b: number } | null {\n  const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n  return result\n    ? {\n        r: parseInt(result[1], 16),\n        g: parseInt(result[2], 16),\n        b: parseInt(result[3], 16),\n      }\n    : null;\n}\n\nfunction rgbToHex(r: number, g: number, b: number): string {\n  return `#${[r, g, b].map((x) => x.toString(16).padStart(2, \"0\")).join(\"\")}`;\n}\n\nfunction hexToHsl(hex: string): { h: number; s: number; l: number } | null {\n  const rgb = hexToRgb(hex);\n  if (!rgb) return null;\n\n  const r = rgb.r / 255;\n  const g = rgb.g / 255;\n  const b = rgb.b / 255;\n\n  const max = Math.max(r, g, b);\n  const min = Math.min(r, g, b);\n  let h = 0;\n  let s = 0;\n  const l = (max + min) / 2;\n\n  if (max !== min) {\n    const d = max - min;\n    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n\n    switch (max) {\n      case r:\n        h = ((g - b) / d + (g < b ? 6 : 0)) / 6;\n        break;\n      case g:\n        h = ((b - r) / d + 2) / 6;\n        break;\n      case b:\n        h = ((r - g) / d + 4) / 6;\n        break;\n    }\n  }\n\n  return {\n    h: Math.round(h * 360),\n    s: Math.round(s * 100),\n    l: Math.round(l * 100),\n  };\n}\n\nfunction hslToHex(h: number, s: number, l: number): string {\n  const hNorm = h / 360;\n  const sNorm = s / 100;\n  const lNorm = l / 100;\n\n  let r = 0;\n  let g = 0;\n  let b = 0;\n\n  if (sNorm === 0) {\n    r = g = b = lNorm;\n  } else {\n    const hue2rgb = (p: number, q: number, t: number) => {\n      if (t < 0) t += 1;\n      if (t > 1) t -= 1;\n      if (t < 1 / 6) return p + (q - p) * 6 * t;\n      if (t < 1 / 2) return q;\n      if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\n      return p;\n    };\n\n    const q = lNorm < 0.5 ? lNorm * (1 + sNorm) : lNorm + sNorm - lNorm * sNorm;\n    const p = 2 * lNorm - q;\n\n    r = hue2rgb(p, q, hNorm + 1 / 3);\n    g = hue2rgb(p, q, hNorm);\n    b = hue2rgb(p, q, hNorm - 1 / 3);\n  }\n\n  return rgbToHex(\n    Math.round(r * 255),\n    Math.round(g * 255),\n    Math.round(b * 255)\n  );\n}\n\nexport const ColorPicker = React.forwardRef<HTMLDivElement, ColorPickerProps>(\n  function ColorPicker(\n    {\n      value = \"#000000\",\n      onChange,\n      format = \"hex\",\n      showPresets = true,\n      presets = defaultPresets,\n      showAlpha = false,\n      className,\n      disabled,\n    },\n    ref\n  ) {\n    const [open, setOpen] = React.useState(false);\n    const [colorValue, setColorValue] = React.useState(value);\n    const [hexInput, setHexInput] = React.useState(value);\n    const [rgbInput, setRgbInput] = React.useState(() => {\n      const rgb = hexToRgb(value);\n      return rgb ? `${rgb.r}, ${rgb.g}, ${rgb.b}` : \"0, 0, 0\";\n    });\n    const [hslInput, setHslInput] = React.useState(() => {\n      const hsl = hexToHsl(value);\n      return hsl ? `${hsl.h}, ${hsl.s}%, ${hsl.l}%` : \"0, 0%, 0%\";\n    });\n\n    React.useEffect(() => {\n      setColorValue(value);\n      setHexInput(value);\n      const rgb = hexToRgb(value);\n      if (rgb) {\n        setRgbInput(`${rgb.r}, ${rgb.g}, ${rgb.b}`);\n      }\n      const hsl = hexToHsl(value);\n      if (hsl) {\n        setHslInput(`${hsl.h}, ${hsl.s}%, ${hsl.l}%`);\n      }\n    }, [value]);\n\n    const handleHexChange = React.useCallback((hex: string) => {\n      setColorValue(hex);\n      setHexInput(hex);\n      const rgb = hexToRgb(hex);\n      if (rgb) {\n        setRgbInput(`${rgb.r}, ${rgb.g}, ${rgb.b}`);\n      }\n      const hsl = hexToHsl(hex);\n      if (hsl) {\n        setHslInput(`${hsl.h}, ${hsl.s}%, ${hsl.l}%`);\n      }\n      onChange?.(hex);\n    }, [onChange]);\n\n    const handleRgbChange = React.useCallback((rgb: { r: number; g: number; b: number; a?: number }) => {\n      const hex = rgbToHex(rgb.r, rgb.g, rgb.b);\n      setColorValue(hex);\n      setHexInput(hex);\n      setRgbInput(`${rgb.r}, ${rgb.g}, ${rgb.b}`);\n      const hsl = hexToHsl(hex);\n      if (hsl) {\n        setHslInput(`${hsl.h}, ${hsl.s}%, ${hsl.l}%`);\n      }\n      onChange?.(hex);\n    }, [onChange]);\n\n    const handleHslChange = React.useCallback((hsl: { h: number; s: number; l: number; a?: number }) => {\n      const hex = hslToHex(hsl.h, hsl.s, hsl.l);\n      setColorValue(hex);\n      setHexInput(hex);\n      const rgb = hexToRgb(hex);\n      if (rgb) {\n        setRgbInput(`${rgb.r}, ${rgb.g}, ${rgb.b}`);\n      }\n      setHslInput(`${hsl.h}, ${hsl.s}%, ${hsl.l}%`);\n      onChange?.(hex);\n    }, [onChange]);\n\n    const handleHexInputChange = React.useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n      const newHex = e.target.value;\n      setHexInput(newHex);\n      if (/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(newHex)) {\n        handleHexChange(newHex);\n      }\n    }, [handleHexChange]);\n\n    const handleRgbInputChange = React.useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n      const newRgb = e.target.value;\n      setRgbInput(newRgb);\n      const match = newRgb.match(/(\\d+),\\s*(\\d+),\\s*(\\d+)/);\n      if (match) {\n        const r = parseInt(match[1], 10);\n        const g = parseInt(match[2], 10);\n        const b = parseInt(match[3], 10);\n        if (r >= 0 && r <= 255 && g >= 0 && g <= 255 && b >= 0 && b <= 255) {\n          handleRgbChange({ r, g, b });\n        }\n      }\n    }, [handleRgbChange]);\n\n    const handleHslInputChange = React.useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n      const newHsl = e.target.value;\n      setHslInput(newHsl);\n      const match = newHsl.match(/(\\d+),\\s*(\\d+)%,\\s*(\\d+)%/);\n      if (match) {\n        const h = parseInt(match[1], 10);\n        const s = parseInt(match[2], 10);\n        const l = parseInt(match[3], 10);\n        if (h >= 0 && h <= 360 && s >= 0 && s <= 100 && l >= 0 && l <= 100) {\n          handleHslChange({ h, s, l });\n        }\n      }\n    }, [handleHslChange]);\n\n    const rgb = React.useMemo(() => hexToRgb(colorValue) || { r: 0, g: 0, b: 0 }, [colorValue]);\n    const hsl = React.useMemo(() => hexToHsl(colorValue) || { h: 0, s: 0, l: 0 }, [colorValue]);\n\n    return (\n      <Popover open={open} onOpenChange={setOpen}>\n        <PopoverTrigger asChild>\n          <Button\n            variant=\"outline\"\n            className={clsx(\"w-full justify-start gap-2\", className)}\n            disabled={disabled}\n          >\n            <div\n              className=\"w-4 h-4 rounded border border-[color:var(--color-border)]\"\n              style={{ backgroundColor: colorValue }}\n            />\n            <span>{colorValue.toUpperCase()}</span>\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent className=\"w-auto p-4\" align=\"start\">\n          <div className=\"space-y-4\">\n            <div className=\"flex flex-col gap-4\">\n              {format === \"hex\" && (\n                <HexColorPicker\n                  color={colorValue}\n                  onChange={handleHexChange}\n                  style={{ width: \"200px\", height: \"200px\" }}\n                />\n              )}\n              {format === \"rgb\" && (\n                <RgbColorPicker\n                  color={rgb}\n                  onChange={handleRgbChange}\n                  style={{ width: \"200px\", height: \"200px\" }}\n                />\n              )}\n              {format === \"hsl\" && (\n                <HslColorPicker\n                  color={hsl}\n                  onChange={handleHslChange}\n                  style={{ width: \"200px\", height: \"200px\" }}\n                />\n              )}\n            </div>\n\n            <div className=\"space-y-2\">\n              <div>\n                <label className=\"text-xs text-[color:var(--color-fg-muted)] mb-1 block\">\n                  HEX\n                </label>\n                <Input\n                  value={hexInput}\n                  onChange={handleHexInputChange}\n                  placeholder=\"#000000\"\n                  className=\"font-mono text-sm\"\n                />\n              </div>\n              <div>\n                <label className=\"text-xs text-[color:var(--color-fg-muted)] mb-1 block\">\n                  RGB\n                </label>\n                <Input\n                  value={rgbInput}\n                  onChange={handleRgbInputChange}\n                  placeholder=\"0, 0, 0\"\n                  className=\"font-mono text-sm\"\n                />\n              </div>\n              <div>\n                <label className=\"text-xs text-[color:var(--color-fg-muted)] mb-1 block\">\n                  HSL\n                </label>\n                <Input\n                  value={hslInput}\n                  onChange={handleHslInputChange}\n                  placeholder=\"0, 0%, 0%\"\n                  className=\"font-mono text-sm\"\n                />\n              </div>\n            </div>\n\n            {showPresets && presets.length > 0 && (\n              <div>\n                <label className=\"text-xs text-[color:var(--color-fg-muted)] mb-2 block\">\n                  Presets\n                </label>\n                <div className=\"grid grid-cols-8 gap-2\">\n                  {presets.map((preset) => (\n                    <button\n                      key={preset}\n                      type=\"button\"\n                      onClick={() => handleHexChange(preset)}\n                      className={clsx(\n                        \"w-8 h-8 rounded border-2 transition-all\",\n                        \"hover:scale-110 focus:outline-none focus:ring-2 focus:ring-brand\",\n                        colorValue.toLowerCase() === preset.toLowerCase()\n                          ? \"border-brand ring-2 ring-brand\"\n                          : \"border-[color:var(--color-border)]\"\n                      )}\n                      style={{ backgroundColor: preset }}\n                      aria-label={`Select color ${preset}`}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        </PopoverContent>\n      </Popover>\n    );\n  }\n);\n\nColorPicker.displayName = \"ColorPicker\";\n\n"
    }
  ]
}