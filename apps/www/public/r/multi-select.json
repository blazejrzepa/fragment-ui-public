{
  "name": "multi-select",
  "type": "registry:block",
  "dependencies": [
    "react",
    "react-dom"
  ],
  "files": [
    {
      "path": "components/ui/multi-select.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport { Command as CommandPrimitive } from \"cmdk\";\nimport clsx from \"clsx\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"./popover\";\nimport { Button } from \"./button\";\nimport { Spinner } from \"./spinner\";\nimport { X } from \"lucide-react\";\n\nexport interface MultiSelectOption {\n  value: string;\n  label: string;\n  disabled?: boolean;\n}\n\nexport interface MultiSelectProps {\n  options: MultiSelectOption[];\n  value?: string[];\n  onValueChange?: (value: string[]) => void;\n  placeholder?: string;\n  searchPlaceholder?: string;\n  emptyText?: string;\n  maxCount?: number; // Max number of selected items to show before \"+X more\"\n  className?: string;\n  disabled?: boolean;\n  clearable?: boolean;\n  loading?: boolean; // Loading state\n  asyncOptions?: boolean; // If true, options can be loaded asynchronously\n}\n\nexport const MultiSelect = React.forwardRef<HTMLButtonElement, MultiSelectProps>(\n  function MultiSelect(\n    {\n      options,\n      value = [],\n      onValueChange,\n      placeholder = \"Select options...\",\n      searchPlaceholder = \"Search...\",\n      emptyText = \"No results found.\",\n      maxCount = 3,\n      className,\n      disabled,\n      clearable = true,\n      loading = false,\n      asyncOptions = false,\n    },\n    ref\n  ) {\n    const [open, setOpen] = React.useState(false);\n    const [search, setSearch] = React.useState(\"\");\n\n    const selectedOptions = React.useMemo(\n      () => options.filter((opt) => value.includes(opt.value)),\n      [options, value]\n    );\n\n    const filteredOptions = React.useMemo(() => {\n      if (!search) return options;\n      return options.filter((option) =>\n        option.label.toLowerCase().includes(search.toLowerCase())\n      );\n    }, [options, search]);\n\n    const handleSelect = React.useCallback((optionValue: string) => {\n      const newValue = value.includes(optionValue)\n        ? value.filter((v) => v !== optionValue)\n        : [...value, optionValue];\n      onValueChange?.(newValue);\n      // Keep popover open for multi-select\n      // Don't call setOpen(false) here\n    }, [value, onValueChange]);\n\n    const handleRemove = (optionValue: string, e: React.MouseEvent) => {\n      e.stopPropagation();\n      const newValue = value.filter((v) => v !== optionValue);\n      onValueChange?.(newValue);\n    };\n\n    const handleClear = (e: React.MouseEvent) => {\n      e.stopPropagation();\n      onValueChange?.([]);\n    };\n\n    const displayValue = React.useMemo(() => {\n      if (selectedOptions.length === 0) return placeholder;\n      if (selectedOptions.length <= maxCount) {\n        return selectedOptions.map((opt) => opt.label).join(\", \");\n      }\n      return `${selectedOptions.slice(0, maxCount).map((opt) => opt.label).join(\", \")} +${selectedOptions.length - maxCount} more`;\n    }, [selectedOptions, maxCount, placeholder]);\n\n\n    return (\n      <Popover open={open} onOpenChange={setOpen} modal={false}>\n        <PopoverTrigger asChild>\n          <Button\n            ref={ref}\n            variant=\"outline\"\n            role=\"combobox\"\n            aria-expanded={open}\n            aria-label={selectedOptions.length > 0 \n              ? `Selected ${selectedOptions.length} option${selectedOptions.length > 1 ? 's' : ''}: ${selectedOptions.map(opt => opt.label).join(', ')}`\n              : placeholder || \"Select options\"}\n            aria-haspopup=\"listbox\"\n            className={clsx(\n              \"w-full justify-between min-h-10 h-auto\",\n              selectedOptions.length > 0 && \"px-2 py-1.5\",\n              className\n            )}\n            disabled={disabled}\n          >\n            <div className=\"flex flex-wrap gap-1 flex-1 text-left\">\n              {selectedOptions.length === 0 ? (\n                <span className=\"text-[color:var(--color-fg-muted)]\">\n                  {placeholder}\n                </span>\n              ) : (\n                <>\n                  {selectedOptions.slice(0, maxCount).map((option) => (\n                    <span\n                      key={option.value}\n                      className=\"inline-flex items-center gap-1 px-2 py-0.5 rounded-[var(--radius-sm)] bg-[color:var(--color-surface-2)] text-sm\"\n                    >\n                      {option.label}\n                      {clearable && (\n                        <span\n                          role=\"button\"\n                          tabIndex={0}\n                          onClick={(e) => handleRemove(option.value, e)}\n                          onKeyDown={(e) => {\n                            if (e.key === \"Enter\" || e.key === \" \") {\n                              e.preventDefault();\n                              handleRemove(option.value, e as any);\n                            }\n                          }}\n                          className=\"ml-1 hover:bg-[color:var(--color-surface-3)] rounded p-0.5 cursor-pointer\"\n                          aria-label={`Remove ${option.label}`}\n                        >\n                          <X className=\"h-3 w-3\" />\n                        </span>\n                      )}\n                    </span>\n                  ))}\n                  {selectedOptions.length > maxCount && (\n                    <span className=\"text-sm text-[color:var(--color-fg-muted)]\">\n                      +{selectedOptions.length - maxCount} more\n                    </span>\n                  )}\n                </>\n              )}\n            </div>\n            <div className=\"flex items-center gap-1 ml-2\">\n              {clearable && selectedOptions.length > 0 && (\n                <span\n                  role=\"button\"\n                  tabIndex={0}\n                  onClick={handleClear}\n                  onKeyDown={(e) => {\n                    if (e.key === \"Enter\" || e.key === \" \") {\n                      e.preventDefault();\n                      handleClear(e as any);\n                    }\n                  }}\n                  className=\"hover:bg-[color:var(--color-surface-2)] rounded p-1 cursor-pointer\"\n                  aria-label=\"Clear all\"\n                >\n                  <X className=\"h-4 w-4\" />\n                </span>\n              )}\n              <span className=\"ml-1\">▼</span>\n            </div>\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent \n          className=\"w-full p-0\" \n          align=\"start\"\n          onEscapeKeyDown={() => {\n            setOpen(false);\n          }}\n        >\n          <CommandPrimitive \n            shouldFilter={false}\n            loop\n          >\n            <div className=\"flex items-center border-b px-3\">\n              <CommandPrimitive.Input\n                placeholder={searchPlaceholder}\n                value={search}\n                onValueChange={setSearch}\n                className=\"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-[color:var(--color-fg-muted)] disabled:cursor-not-allowed disabled:opacity-50\"\n              />\n            </div>\n            {loading ? (\n              <div className=\"py-6 text-center text-sm flex items-center justify-center gap-2\">\n                <Spinner className=\"h-4 w-4\" />\n                <span>Loading...</span>\n              </div>\n            ) : (\n              <CommandPrimitive.Empty className=\"py-6 text-center text-sm\">\n                {emptyText}\n              </CommandPrimitive.Empty>\n            )}\n            <CommandPrimitive.Group>\n              <CommandPrimitive.List role=\"listbox\" aria-label=\"Options\">\n                {filteredOptions.map((option) => {\n                  const isSelected = value.includes(option.value);\n                  return (\n                    <div\n                      key={option.value}\n                      role=\"option\"\n                      aria-selected={isSelected}\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        if (!option.disabled) {\n                          handleSelect(option.value);\n                        }\n                      }}\n                      onKeyDown={(e) => {\n                        if (e.key === \"Enter\" || e.key === \" \") {\n                          e.preventDefault();\n                          if (!option.disabled) {\n                            handleSelect(option.value);\n                          }\n                        }\n                      }}\n                      tabIndex={option.disabled ? -1 : 0}\n                      className={clsx(\n                        \"relative flex cursor-pointer select-none items-center rounded-[var(--radius-sm)] px-2 py-1.5 text-sm outline-none hover:bg-[color:var(--color-surface-2)]\",\n                        isSelected && \"bg-[color:var(--color-surface-2)]\",\n                        option.disabled && \"opacity-50 cursor-not-allowed pointer-events-none\"\n                      )}\n                    >\n                      <div className=\"flex items-center gap-2 flex-1 w-full\">\n                        <div\n                          className={clsx(\n                            \"h-4 w-4 rounded border flex items-center justify-center flex-shrink-0\",\n                            isSelected\n                              ? \"bg-brand border-brand\"\n                              : \"border-[color:var(--color-fg-muted)]\"\n                          )}\n                        >\n                          {isSelected && (\n                            <span className=\"text-white text-xs\">✓</span>\n                          )}\n                        </div>\n                        <span className=\"flex-1\">{option.label}</span>\n                      </div>\n                    </div>\n                  );\n                })}\n              </CommandPrimitive.List>\n            </CommandPrimitive.Group>\n          </CommandPrimitive>\n        </PopoverContent>\n      </Popover>\n    );\n  }\n);\n\n"
    },
    {
      "path": "components/ui/popover.tsx",
      "content": "import * as React from \"react\";\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\";\nimport clsx from \"clsx\";\n\nconst Popover = PopoverPrimitive.Root;\nconst PopoverTrigger = PopoverPrimitive.Trigger;\nconst PopoverClose = PopoverPrimitive.Close;\n\nexport interface PopoverProps\n  extends React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content> {\n  children: React.ReactNode;\n  trigger: React.ReactNode;\n  open?: boolean;\n  onOpenChange?: (open: boolean) => void;\n}\n\nexport interface PopoverContentProps\n  extends React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content> {\n  /**\n   * Align the popover relative to the trigger\n   * @default \"center\"\n   */\n  align?: \"start\" | \"center\" | \"end\";\n  /**\n   * Side of the trigger to render against\n   * @default \"bottom\"\n   */\n  side?: \"top\" | \"right\" | \"bottom\" | \"left\";\n  /**\n   * Distance in pixels from the trigger\n   * @default 4\n   */\n  sideOffset?: number;\n  /**\n   * Additional offset in pixels from the aligned edge\n   * @default 0\n   */\n  alignOffset?: number;\n  /**\n   * Enable collision detection to automatically flip sides\n   * @default true\n   */\n  collisionPadding?: number | { top?: number; right?: number; bottom?: number; left?: number };\n  /**\n   * Enable portal rendering (useful for z-index stacking)\n   * @default true\n   */\n  portal?: boolean;\n}\n\nexport const PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  PopoverContentProps\n>(function PopoverContent(\n  {\n    className,\n    align = \"center\",\n    side = \"bottom\",\n    sideOffset = 4,\n    alignOffset = 0,\n    collisionPadding = 8,\n    portal = true,\n    ...props\n  },\n  ref\n) {\n  const content = (\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      side={side}\n      sideOffset={sideOffset}\n      alignOffset={alignOffset}\n      collisionPadding={collisionPadding}\n      className={clsx(\n        \"z-50 w-72 rounded-[var(--radius-lg)] border border-[color:var(--color-fg-muted)] bg-[color:var(--color-surface-1)] p-4 text-[color:var(--color-fg-base)] shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  );\n\n  if (portal) {\n    return <PopoverPrimitive.Portal>{content}</PopoverPrimitive.Portal>;\n  }\n\n  return content;\n});\n\n// Convenience wrapper component\nexport function PopoverWrapper({ children, trigger, open, onOpenChange, ...props }: PopoverProps) {\n  return (\n    <Popover open={open} onOpenChange={onOpenChange}>\n      <PopoverTrigger asChild>{trigger}</PopoverTrigger>\n      <PopoverContent {...props}>{children}</PopoverContent>\n    </Popover>\n  );\n}\n\n// Export Popover components for convenience\nexport { Popover, PopoverTrigger, PopoverClose };\n\n"
    },
    {
      "path": "components/ui/command.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport { Command as CommandPrimitive } from \"cmdk\";\nimport { Dialog, DialogContent, DialogTitle, DialogDescription } from \"./dialog\";\nimport * as VisuallyHiddenPrimitive from \"@radix-ui/react-visually-hidden\";\nimport clsx from \"clsx\";\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={clsx(\n      \"flex h-full w-full flex-col overflow-hidden rounded-[var(--radius-md)] bg-[color:var(--color-surface-1)] text-[color:var(--color-fg-base)]\",\n      className\n    )}\n    {...props}\n  />\n));\nCommand.displayName = CommandPrimitive.displayName;\n\nconst CommandDialog = ({\n  children,\n  ...props\n}: React.ComponentPropsWithoutRef<typeof Dialog>) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0\">\n        <VisuallyHiddenPrimitive.Root>\n          <DialogTitle>Command Palette</DialogTitle>\n          <DialogDescription>\n            Search for commands and actions. Use arrow keys to navigate, Enter to select.\n          </DialogDescription>\n        </VisuallyHiddenPrimitive.Root>\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-[color:var(--color-fg-muted)] [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-1 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\">\n    <CommandPrimitive.Input\n      ref={ref}\n      className={clsx(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-[color:var(--color-fg-muted)] disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n));\n\nCommandInput.displayName = CommandPrimitive.Input.displayName;\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={clsx(\n      \"max-h-[300px] overflow-y-auto overflow-x-hidden\",\n      className\n    )}\n    {...props}\n  />\n));\n\nCommandList.displayName = CommandPrimitive.List.displayName;\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className={clsx(\"py-6 text-center text-sm\", className)}\n    {...props}\n  />\n));\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName;\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={clsx(\n      \"overflow-hidden p-1 text-[color:var(--color-fg-base)] [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-[color:var(--color-fg-muted)]\",\n      className\n    )}\n    {...props}\n  />\n));\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName;\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={clsx(\"-mx-1 h-px bg-[color:var(--color-fg-muted)]\", className)}\n    {...props}\n  />\n));\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName;\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={clsx(\n      \"relative flex cursor-default select-none items-center rounded-[var(--radius-sm)] px-2 py-1.5 text-sm outline-none aria-selected:bg-[color:var(--color-surface-2)] aria-selected:text-[color:var(--color-fg-base)] data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  />\n));\n\nCommandItem.displayName = CommandPrimitive.Item.displayName;\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={clsx(\n        \"ml-auto text-xs tracking-widest text-[color:var(--color-fg-muted)]\",\n        className\n      )}\n      {...props}\n    />\n  );\n};\nCommandShortcut.displayName = \"CommandShortcut\";\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n};\n\n\n"
    }
  ]
}