{
  "name": "datatable",
  "type": "registry:component",
  "dependencies": [
    "react",
    "react-dom",
    "@fragment_ui/ui"
  ],
  "files": [
    {
      "path": "components/ui/DataTable.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"./table\";\nimport { Checkbox } from \"./checkbox\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"./dropdown-menu\";\nimport { Button } from \"./button\";\nimport { Input } from \"./input\";\nimport { ArrowUpDown, ArrowUp, ArrowDown, MoreHorizontal, GripVertical } from \"lucide-react\";\nimport clsx from \"clsx\";\n\nexport type SortDirection = \"asc\" | \"desc\" | null;\n\n// Separate component for row actions to ensure stable IDs for hydration\nfunction RowActionsMenu<T extends Record<string, any>>({\n  row,\n  index,\n  rowKey,\n  actions,\n}: {\n  row: T;\n  index: number;\n  rowKey: string | number;\n  actions: RowAction<T>[];\n}) {\n  const menuId = React.useId();\n  \n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild suppressHydrationWarning>\n        <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n          <MoreHorizontal className=\"h-4 w-4\" />\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\">\n        {actions.map((action, actionIndex) => {\n          const disabled = action.disabled?.(row, index) ?? false;\n          return (\n            <DropdownMenuItem\n              key={actionIndex}\n              disabled={disabled}\n              onClick={() => action.onClick(row, index)}\n            >\n              {action.icon && <span className=\"mr-2\">{action.icon}</span>}\n              {action.label}\n            </DropdownMenuItem>\n          );\n        })}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n\nexport interface DataTableColumn<T> {\n  id: string;\n  header: string;\n  accessor: (row: T, index: number) => React.ReactNode;\n  sortable?: boolean;\n  filterable?: boolean;\n  resizable?: boolean;\n  width?: number | string;\n  minWidth?: number;\n  maxWidth?: number;\n  className?: string;\n  headerClassName?: string;\n  cellClassName?: string | ((row: T, index: number) => string);\n}\n\nexport interface RowAction<T> {\n  label: string;\n  onClick: (row: T, index: number) => void;\n  disabled?: (row: T, index: number) => boolean;\n  icon?: React.ReactNode;\n}\n\nexport interface DataTableProps<T extends Record<string, any>> {\n  data: T[];\n  columns: DataTableColumn<T>[];\n  getRowKey?: (row: T, index: number) => string | number;\n  selectable?: boolean;\n  selectedRows?: Set<string | number>;\n  onSelectionChange?: (selected: Set<string | number>) => void;\n  sortable?: boolean;\n  defaultSort?: { columnId: string; direction: SortDirection };\n  onSortChange?: (columnId: string | null, direction: SortDirection) => void;\n  filterable?: boolean;\n  filters?: Record<string, string>;\n  onFilterChange?: (filters: Record<string, string>) => void;\n  resizable?: boolean;\n  rowActions?: RowAction<T>[];\n  onRowClick?: (row: T, index: number) => void;\n  emptyMessage?: string;\n  className?: string;\n  headerClassName?: string;\n  rowClassName?: string | ((row: T, index: number) => string);\n}\n\nexport function DataTable<T extends Record<string, any>>({\n  data,\n  columns,\n  getRowKey,\n  selectable = false,\n  selectedRows: controlledSelectedRows,\n  onSelectionChange,\n  sortable = false,\n  defaultSort,\n  onSortChange,\n  filterable = false,\n  filters: controlledFilters,\n  onFilterChange,\n  resizable = false,\n  rowActions,\n  onRowClick,\n  emptyMessage = \"No data available\",\n  className,\n  headerClassName,\n  rowClassName,\n}: DataTableProps<T>) {\n  const [internalSelectedRows, setInternalSelectedRows] = React.useState<Set<string | number>>(new Set());\n  const [internalSort, setInternalSort] = React.useState<{ columnId: string; direction: SortDirection } | null>(\n    defaultSort ? { columnId: defaultSort.columnId, direction: defaultSort.direction } : null\n  );\n  const [internalFilters, setInternalFilters] = React.useState<Record<string, string>>({});\n  const [columnWidths, setColumnWidths] = React.useState<Record<string, number>>({});\n  const [resizingColumn, setResizingColumn] = React.useState<string | null>(null);\n\n  const selectedRows = controlledSelectedRows ?? internalSelectedRows;\n  const setSelectedRows = onSelectionChange\n    ? (newSelected: Set<string | number>) => onSelectionChange(newSelected)\n    : setInternalSelectedRows;\n\n  const filters = controlledFilters ?? internalFilters;\n  const setFilters = onFilterChange\n    ? (newFilters: Record<string, string>) => onFilterChange(newFilters)\n    : setInternalFilters;\n\n  // Get row key\n  const getKey = React.useCallback(\n    (row: T, index: number): string | number => {\n      if (getRowKey) return getRowKey(row, index);\n      if (\"id\" in row && (typeof row.id === \"string\" || typeof row.id === \"number\")) return row.id;\n      return index;\n    },\n    [getRowKey]\n  );\n\n  // Filter data\n  const filteredData = React.useMemo(() => {\n    if (!filterable || Object.keys(filters).length === 0) return data;\n\n    return data.filter((row) => {\n      return columns.every((column) => {\n        if (!column.filterable || !filters[column.id]) return true;\n        const value = column.accessor(row, 0);\n        const filterValue = filters[column.id].toLowerCase();\n        return String(value).toLowerCase().includes(filterValue);\n      });\n    });\n  }, [data, filters, columns, filterable]);\n\n  // Sort data\n  const sortedData = React.useMemo(() => {\n    if (!sortable || !internalSort || !internalSort.direction) return filteredData;\n\n    const column = columns.find((col) => col.id === internalSort!.columnId);\n    if (!column || !column.sortable) return filteredData;\n\n    return [...filteredData].sort((a, b) => {\n      const aValue = column.accessor(a, 0);\n      const bValue = column.accessor(b, 0);\n\n      // Handle null/undefined values\n      if (aValue == null && bValue == null) return 0;\n      if (aValue == null) return 1;\n      if (bValue == null) return -1;\n\n      let comparison = 0;\n      if (aValue < bValue) comparison = -1;\n      if (aValue > bValue) comparison = 1;\n\n      return internalSort!.direction === \"asc\" ? comparison : -comparison;\n    });\n  }, [filteredData, internalSort, columns, sortable]);\n\n  // Selection handlers\n  const handleSelectAll = React.useCallback(() => {\n    const allKeys = sortedData.map((row, index) => getKey(row, index));\n    if (selectedRows.size === sortedData.length) {\n      setSelectedRows(new Set());\n    } else {\n      setSelectedRows(new Set(allKeys));\n    }\n  }, [sortedData, selectedRows, setSelectedRows, getKey]);\n\n  const handleSelectRow = React.useCallback(\n    (rowKey: string | number) => {\n      const newSelected = new Set(selectedRows);\n      if (newSelected.has(rowKey)) {\n        newSelected.delete(rowKey);\n      } else {\n        newSelected.add(rowKey);\n      }\n      setSelectedRows(newSelected);\n    },\n    [selectedRows, setSelectedRows]\n  );\n\n  // Sort handlers\n  const handleSort = React.useCallback(\n    (columnId: string) => {\n      const column = columns.find((col) => col.id === columnId);\n      if (!column || !column.sortable) return;\n\n      let newDirection: SortDirection = \"asc\";\n      if (internalSort?.columnId === columnId) {\n        if (internalSort.direction === \"asc\") {\n          newDirection = \"desc\";\n        } else if (internalSort.direction === \"desc\") {\n          newDirection = null;\n        }\n      }\n\n      const newSort = newDirection ? { columnId, direction: newDirection } : null;\n      setInternalSort(newSort);\n      onSortChange?.(columnId, newDirection);\n    },\n    [internalSort, columns, onSortChange]\n  );\n\n  // Filter handlers\n  const handleFilterChange = React.useCallback(\n    (columnId: string, value: string) => {\n      const newFilters = { ...filters };\n      if (value) {\n        newFilters[columnId] = value;\n      } else {\n        delete newFilters[columnId];\n      }\n      setFilters(newFilters);\n    },\n    [filters, setFilters]\n  );\n\n  // Resize handlers\n  const handleResizeStart = React.useCallback(\n    (e: React.MouseEvent, columnId: string) => {\n      e.preventDefault();\n      setResizingColumn(columnId);\n      const startX = e.clientX;\n      const column = columns.find((col) => col.id === columnId);\n      const startWidth = columnWidths[columnId] || (column?.width ? Number(column.width) : 150);\n\n      const handleMouseMove = (moveEvent: MouseEvent) => {\n        const diff = moveEvent.clientX - startX;\n        const newWidth = Math.max(column?.minWidth || 50, Math.min(column?.maxWidth || 1000, startWidth + diff));\n        setColumnWidths((prev) => ({ ...prev, [columnId]: newWidth }));\n      };\n\n      const handleMouseUp = () => {\n        setResizingColumn(null);\n        document.removeEventListener(\"mousemove\", handleMouseMove);\n        document.removeEventListener(\"mouseup\", handleMouseUp);\n      };\n\n      document.addEventListener(\"mousemove\", handleMouseMove);\n      document.addEventListener(\"mouseup\", handleMouseUp);\n    },\n    [columns, columnWidths]\n  );\n\n  // Get row class\n  const getRowClass = React.useCallback(\n    (row: T, index: number): string => {\n      if (typeof rowClassName === \"function\") {\n        return rowClassName(row, index);\n      }\n      return rowClassName || \"\";\n    },\n    [rowClassName]\n  );\n\n  const allSelected = sortedData.length > 0 && selectedRows.size === sortedData.length;\n  const someSelected = selectedRows.size > 0 && selectedRows.size < sortedData.length;\n\n  return (\n    <div className={clsx(\"w-full\", className)}>\n      {/* Filters */}\n      {filterable && (\n        <div className=\"mb-4 flex gap-2 flex-wrap\">\n          {columns\n            .filter((col) => col.filterable)\n            .map((column) => (\n              <Input\n                key={column.id}\n                placeholder={`Filter ${column.header}...`}\n                value={filters[column.id] || \"\"}\n                onChange={(e) => handleFilterChange(column.id, e.target.value)}\n                className=\"w-[200px]\"\n              />\n            ))}\n        </div>\n      )}\n\n      <div className=\"rounded-md border border-[color:var(--color-border-base)] mt-2.5 mb-2.5\">\n        <Table>\n          <TableHeader>\n            <TableRow>\n              {selectable && (\n                <TableHead className=\"w-12 pl-4\">\n                  <Checkbox\n                    checked={allSelected}\n                    onCheckedChange={handleSelectAll}\n                    aria-label=\"Select all\"\n                    className={clsx(\n                      someSelected && \"data-[state=checked]:bg-[color:var(--color-brand-primary)] data-[state=checked]:border-[color:var(--color-brand-primary)]\",\n                      !allSelected && !someSelected && \"data-[state=checked]:bg-[color:var(--color-brand-primary)] data-[state=checked]:border-[color:var(--color-brand-primary)]\"\n                    )}\n                  />\n                </TableHead>\n              )}\n              {rowActions && <TableHead className=\"w-12\" />}\n              {columns.map((column) => {\n                const columnWidth = columnWidths[column.id] || column.width;\n                const isSorted = internalSort?.columnId === column.id;\n                const sortDirection = isSorted ? internalSort.direction : null;\n\n                return (\n                  <TableHead\n                    key={column.id}\n                    className={clsx(\n                      column.sortable && \"cursor-pointer select-none\",\n                      column.headerClassName,\n                      headerClassName\n                    )}\n                    style={columnWidth ? { width: columnWidth } : undefined}\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      {column.sortable ? (\n                        <button\n                          onClick={() => handleSort(column.id)}\n                          className=\"flex items-center gap-1\"\n                        >\n                          <span>{column.header}</span>\n                          {sortDirection === \"asc\" ? (\n                            <ArrowUp className=\"h-4 w-4\" />\n                          ) : sortDirection === \"desc\" ? (\n                            <ArrowDown className=\"h-4 w-4\" />\n                          ) : (\n                            <ArrowUpDown className=\"h-4 w-4 opacity-50\" />\n                          )}\n                        </button>\n                      ) : (\n                        <span>{column.header}</span>\n                      )}\n                      {resizable && column.resizable !== false && (\n                        <div\n                          className={clsx(\n                            \"ml-auto cursor-col-resize hover:bg-[color:var(--color-brand-primary)] w-1 h-4 rounded\",\n                            resizingColumn === column.id && \"bg-[color:var(--color-brand-primary)]\"\n                          )}\n                          onMouseDown={(e) => handleResizeStart(e, column.id)}\n                        />\n                      )}\n                    </div>\n                  </TableHead>\n                );\n              })}\n            </TableRow>\n          </TableHeader>\n          <TableBody>\n            {sortedData.length === 0 ? (\n              <TableRow>\n                <TableCell colSpan={columns.length + (selectable ? 1 : 0) + (rowActions ? 1 : 0)} className=\"h-24 text-center\">\n                  {emptyMessage}\n                </TableCell>\n              </TableRow>\n            ) : (\n              sortedData.map((row, index) => {\n                const rowKey = getKey(row, index);\n                const isSelected = selectedRows.has(rowKey);\n                const rowClass = getRowClass(row, index);\n\n                return (\n                  <TableRow\n                    key={rowKey}\n                    className={clsx(\n                      isSelected && \"bg-[color:var(--color-surface-2)]\",\n                      onRowClick && \"cursor-pointer\",\n                      rowClass\n                    )}\n                    onClick={() => onRowClick?.(row, index)}\n                  >\n                    {selectable && (\n                      <TableCell className=\"pl-4\">\n                        <Checkbox\n                          checked={isSelected}\n                          onCheckedChange={() => handleSelectRow(rowKey)}\n                          aria-label={`Select row ${index + 1}`}\n                          onClick={(e) => e.stopPropagation()}\n                        />\n                      </TableCell>\n                    )}\n                    {rowActions && (\n                      <TableCell onClick={(e) => e.stopPropagation()}>\n                        <RowActionsMenu row={row} index={index} rowKey={rowKey} actions={rowActions} />\n                      </TableCell>\n                    )}\n                    {columns.map((column) => {\n                      const columnWidth = columnWidths[column.id] || column.width;\n                      const cellClass =\n                        typeof column.cellClassName === \"function\"\n                          ? column.cellClassName(row, index)\n                          : column.cellClassName;\n\n                      return (\n                        <TableCell\n                          key={column.id}\n                          className={cellClass}\n                          style={columnWidth ? { width: columnWidth } : undefined}\n                        >\n                          {column.accessor(row, index)}\n                        </TableCell>\n                      );\n                    })}\n                  </TableRow>\n                );\n              })\n            )}\n          </TableBody>\n        </Table>\n      </div>\n    </div>\n  );\n}\n\n"
    }
  ]
}