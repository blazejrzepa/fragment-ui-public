{
  "name": "tree-view",
  "type": "registry:block",
  "dependencies": [
    "react",
    "react-dom"
  ],
  "files": [
    {
      "path": "components/ui/tree-view.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport { Checkbox } from \"./checkbox\";\nimport clsx from \"clsx\";\nimport { ChevronRight, Folder, File, FolderOpen } from \"lucide-react\";\n\nexport interface TreeNode {\n  id: string;\n  label: string;\n  children?: TreeNode[];\n  icon?: React.ReactNode;\n  disabled?: boolean;\n  data?: Record<string, any>;\n}\n\nexport interface TreeViewProps {\n  nodes: TreeNode[];\n  selectedIds?: string[];\n  expandedIds?: string[];\n  onSelectionChange?: (selectedIds: string[]) => void;\n  onExpansionChange?: (expandedIds: string[]) => void;\n  onNodeClick?: (node: TreeNode) => void;\n  onNodeDoubleClick?: (node: TreeNode) => void;\n  showCheckboxes?: boolean;\n  showIcons?: boolean;\n  defaultExpanded?: boolean;\n  className?: string;\n  indentSize?: number;\n}\n\nfunction TreeNodeComponent({\n  node,\n  level = 0,\n  selectedIds = [],\n  expandedIds = [],\n  onSelectionChange,\n  onExpansionChange,\n  onNodeClick,\n  onNodeDoubleClick,\n  showCheckboxes = false,\n  showIcons = true,\n  defaultExpanded = false,\n  indentSize = 20,\n}: {\n  node: TreeNode;\n  level?: number;\n  selectedIds: string[];\n  expandedIds: string[];\n  onSelectionChange?: (selectedIds: string[]) => void;\n  onExpansionChange?: (expandedIds: string[]) => void;\n  onNodeClick?: (node: TreeNode) => void;\n  onNodeDoubleClick?: (node: TreeNode) => void;\n  showCheckboxes?: boolean;\n  showIcons?: boolean;\n  defaultExpanded?: boolean;\n  indentSize?: number;\n}) {\n  const hasChildren = node.children && node.children.length > 0;\n  const isExpanded = expandedIds.includes(node.id);\n  const isSelected = selectedIds.includes(node.id);\n  const isIndeterminate = React.useMemo(() => {\n    if (!hasChildren || !showCheckboxes) return false;\n    const childIds = getAllChildIds(node);\n    const selectedChildren = childIds.filter((id) => selectedIds.includes(id));\n    return selectedChildren.length > 0 && selectedChildren.length < childIds.length;\n  }, [node, selectedIds, hasChildren, showCheckboxes]);\n\n  const handleToggle = React.useCallback(() => {\n    if (node.disabled) return;\n    if (onExpansionChange) {\n      if (isExpanded) {\n        onExpansionChange(expandedIds.filter((id) => id !== node.id));\n      } else {\n        onExpansionChange([...expandedIds, node.id]);\n      }\n    } else {\n      // Uncontrolled mode - use internal state\n      // This is handled by the parent TreeView component\n    }\n  }, [node, isExpanded, expandedIds, onExpansionChange]);\n\n  const handleCheckboxChange = React.useCallback((checked: boolean) => {\n    if (node.disabled || !onSelectionChange) return;\n    const childIds = getAllChildIds(node);\n    if (checked) {\n      // Select this node and all children\n      const newSelected = [...new Set([...selectedIds, node.id, ...childIds])];\n      onSelectionChange(newSelected);\n    } else {\n      // Deselect this node and all children\n      const newSelected = selectedIds.filter((id) => id !== node.id && !childIds.includes(id));\n      onSelectionChange(newSelected);\n    }\n  }, [node, selectedIds, onSelectionChange]);\n\n  const handleNodeClick = React.useCallback(() => {\n    if (node.disabled) return;\n    onNodeClick?.(node);\n    if (hasChildren) {\n      handleToggle();\n    }\n  }, [node, hasChildren, handleToggle, onNodeClick]);\n\n  const handleNodeDoubleClick = React.useCallback(() => {\n    if (node.disabled) return;\n    onNodeDoubleClick?.(node);\n  }, [node, onNodeDoubleClick]);\n\n  const defaultIcon = hasChildren ? (\n    isExpanded ? <FolderOpen className=\"h-4 w-4\" /> : <Folder className=\"h-4 w-4\" />\n  ) : (\n    <File className=\"h-4 w-4\" />\n  );\n\n  return (\n    <div className=\"tree-node\" role=\"treeitem\" aria-expanded={hasChildren ? isExpanded : undefined} aria-selected={isSelected}>\n      <div\n        className={clsx(\n          \"flex items-center gap-2 py-1 px-2 rounded-[var(--radius-sm)]\",\n          \"hover:bg-[color:var(--color-surface-2)]\",\n          \"cursor-pointer select-none\",\n          isSelected && \"bg-[color:var(--color-surface-2)]\",\n          node.disabled && \"opacity-50 cursor-not-allowed\"\n        )}\n        style={{ paddingLeft: `${level * indentSize + 8}px` }}\n        onClick={handleNodeClick}\n        onDoubleClick={handleNodeDoubleClick}\n      >\n        {showCheckboxes && (\n          <div className=\"relative\">\n            <Checkbox\n              checked={isSelected || isIndeterminate}\n              onCheckedChange={handleCheckboxChange}\n              onClick={(e) => e.stopPropagation()}\n              disabled={node.disabled}\n              className={clsx(isIndeterminate && \"data-[state=checked]:bg-brand/50\")}\n            />\n            {isIndeterminate && (\n              <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\n                <div className=\"w-2 h-0.5 bg-white\" />\n              </div>\n            )}\n          </div>\n        )}\n        {hasChildren ? (\n          <button\n            type=\"button\"\n            className=\"flex items-center justify-center w-4 h-4 p-0 hover:bg-transparent\"\n            onClick={(e) => {\n              e.stopPropagation();\n              handleToggle();\n            }}\n            aria-label={isExpanded ? `Collapse ${node.label}` : `Expand ${node.label}`}\n            aria-expanded={isExpanded}\n            aria-controls={`tree-node-${node.id}`}\n          >\n            <ChevronRight\n              className={clsx(\n                \"h-4 w-4 transition-transform duration-200\",\n                isExpanded && \"rotate-90\"\n              )}\n            />\n          </button>\n        ) : (\n          <div className=\"w-4\" />\n        )}\n        {showIcons && <div className=\"flex-shrink-0\">{node.icon || defaultIcon}</div>}\n        <span className=\"flex-1 text-sm\">{node.label}</span>\n      </div>\n      {hasChildren && (\n        <div\n          id={`tree-node-${node.id}`}\n          role=\"group\"\n          className={clsx(\n            \"overflow-hidden transition-all duration-200\",\n            isExpanded ? \"max-h-[10000px] opacity-100\" : \"max-h-0 opacity-0\"\n          )}\n        >\n          <div className=\"tree-node-children\" role=\"tree\">\n            {node.children!.map((child) => (\n              <TreeNodeComponent\n                key={child.id}\n                node={child}\n                level={level + 1}\n                selectedIds={selectedIds}\n                expandedIds={expandedIds}\n                onSelectionChange={onSelectionChange}\n                onExpansionChange={onExpansionChange}\n                onNodeClick={onNodeClick}\n                onNodeDoubleClick={onNodeDoubleClick}\n                showCheckboxes={showCheckboxes}\n                showIcons={showIcons}\n                defaultExpanded={defaultExpanded}\n                indentSize={indentSize}\n              />\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction getAllChildIds(node: TreeNode): string[] {\n  const ids: string[] = [];\n  if (node.children) {\n    node.children.forEach((child) => {\n      ids.push(child.id);\n      ids.push(...getAllChildIds(child));\n    });\n  }\n  return ids;\n}\n\nexport const TreeView = React.forwardRef<HTMLDivElement, TreeViewProps>(\n  function TreeView(\n    {\n      nodes,\n      selectedIds = [],\n      expandedIds = [],\n      onSelectionChange,\n      onExpansionChange,\n      onNodeClick,\n      onNodeDoubleClick,\n      showCheckboxes = false,\n      showIcons = true,\n      defaultExpanded = false,\n      className,\n      indentSize = 20,\n    },\n    ref\n  ) {\n    // Initialize with defaultExpanded if no expandedIds provided\n    const initialExpandedIds = React.useMemo(() => {\n      if (expandedIds.length > 0) return expandedIds;\n      if (defaultExpanded) {\n        // Get all node IDs recursively\n        const getAllNodeIds = (nodes: TreeNode[]): string[] => {\n          const ids: string[] = [];\n          nodes.forEach(node => {\n            ids.push(node.id);\n            if (node.children) {\n              ids.push(...getAllNodeIds(node.children));\n            }\n          });\n          return ids;\n        };\n        return getAllNodeIds(nodes);\n      }\n      return [];\n    }, []);\n\n    const [internalExpandedIds, setInternalExpandedIds] = React.useState<string[]>(initialExpandedIds);\n    const [internalSelectedIds, setInternalSelectedIds] = React.useState<string[]>(selectedIds);\n\n    // Sync with controlled props\n    React.useEffect(() => {\n      if (expandedIds.length > 0) {\n        setInternalExpandedIds(expandedIds);\n      }\n    }, [expandedIds]);\n\n    React.useEffect(() => {\n      setInternalSelectedIds(selectedIds);\n    }, [selectedIds]);\n\n    const handleExpansionChange = React.useCallback(\n      (newExpandedIds: string[]) => {\n        setInternalExpandedIds(newExpandedIds);\n        onExpansionChange?.(newExpandedIds);\n      },\n      [onExpansionChange]\n    );\n\n    const handleSelectionChange = React.useCallback(\n      (newSelectedIds: string[]) => {\n        setInternalSelectedIds(newSelectedIds);\n        onSelectionChange?.(newSelectedIds);\n      },\n      [onSelectionChange]\n    );\n\n    return (\n      <div\n        ref={ref}\n        className={clsx(\n          \"tree-view w-full border border-[color:var(--color-border)] rounded-[var(--radius-md)] p-2\",\n          \"bg-[color:var(--color-surface-1)]\",\n          className\n        )}\n        role=\"tree\"\n        aria-label=\"Tree view\"\n      >\n        {nodes.map((node) => (\n          <TreeNodeComponent\n            key={node.id}\n            node={node}\n            level={0}\n            selectedIds={internalSelectedIds}\n            expandedIds={internalExpandedIds}\n            onSelectionChange={handleSelectionChange}\n            onExpansionChange={handleExpansionChange}\n            onNodeClick={onNodeClick}\n            onNodeDoubleClick={onNodeDoubleClick}\n            showCheckboxes={showCheckboxes}\n            showIcons={showIcons}\n            defaultExpanded={defaultExpanded}\n            indentSize={indentSize}\n          />\n        ))}\n      </div>\n    );\n  }\n);\n\nTreeView.displayName = \"TreeView\";\n\n"
    }
  ]
}