{
  "name": "commandpalette",
  "type": "registry:component",
  "dependencies": [
    "react",
    "react-dom",
    "@fragment_ui/ui"
  ],
  "files": [
    {
      "path": "components/ui/CommandPalette.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport {\n  Command,\n  CommandDialog,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n  CommandSeparator,\n  CommandShortcut,\n} from \"./command\";\nimport { Button } from \"./button\";\n\nexport interface CommandPaletteAction {\n  id: string;\n  label: string;\n  keywords?: string[];\n  shortcut?: string;\n  icon?: React.ReactNode;\n  onSelect?: () => void;\n  group?: string;\n  children?: CommandPaletteAction[]; // Nested commands\n}\n\nexport interface CommandPaletteProps {\n  actions?: CommandPaletteAction[];\n  trigger?: React.ReactNode;\n  placeholder?: string;\n  emptyText?: string;\n  showRecentCommands?: boolean;\n  maxRecentCommands?: number;\n  recentCommandsStorageKey?: string;\n}\n\nexport function CommandPalette({\n  actions = [],\n  trigger,\n  placeholder = \"Type a command or search...\",\n  emptyText = \"No results found.\",\n  showRecentCommands = true,\n  maxRecentCommands = 5,\n  recentCommandsStorageKey = \"command-palette-recent\",\n}: CommandPaletteProps) {\n  // Ensure actions is always an array\n  const safeActions = React.useMemo(() => {\n    if (!actions || !Array.isArray(actions)) {\n      return [];\n    }\n    return actions;\n  }, [actions]);\n  \n  const [open, setOpen] = React.useState(false);\n  const [recentCommands, setRecentCommands] = React.useState<string[]>([]);\n\n  // Load recent commands from localStorage\n  React.useEffect(() => {\n    if (showRecentCommands && typeof window !== \"undefined\") {\n      const stored = localStorage.getItem(recentCommandsStorageKey);\n      if (stored) {\n        try {\n          setRecentCommands(JSON.parse(stored));\n        } catch {\n          // Invalid JSON, ignore\n        }\n      }\n    }\n  }, [showRecentCommands, recentCommandsStorageKey]);\n\n  // Save recent commands to localStorage\n  const saveRecentCommand = React.useCallback(\n    (commandId: string) => {\n      if (!showRecentCommands) return;\n      setRecentCommands((prev) => {\n        const filtered = prev.filter((id) => id !== commandId);\n        const updated = [commandId, ...filtered].slice(0, maxRecentCommands);\n        if (typeof window !== \"undefined\") {\n          localStorage.setItem(recentCommandsStorageKey, JSON.stringify(updated));\n        }\n        return updated;\n      });\n    },\n    [showRecentCommands, maxRecentCommands, recentCommandsStorageKey]\n  );\n\n  React.useEffect(() => {\n    const down = (e: KeyboardEvent) => {\n      if (e.key === \"k\" && (e.metaKey || e.ctrlKey)) {\n        e.preventDefault();\n        setOpen((open) => !open);\n      }\n    };\n\n    document.addEventListener(\"keydown\", down);\n    return () => document.removeEventListener(\"keydown\", down);\n  }, []);\n\n  // Flatten nested commands\n  const flattenActions = React.useCallback((actions: CommandPaletteAction[] | undefined): CommandPaletteAction[] => {\n    try {\n    if (!actions || !Array.isArray(actions) || actions.length === 0) {\n      return [];\n    }\n    const flattened: CommandPaletteAction[] = [];\n      if (Array.isArray(actions)) {\n    actions.forEach((action) => {\n          if (!action) return; // Skip null/undefined actions\n          if (action.children && Array.isArray(action.children) && action.children.length > 0) {\n        // Add parent as a category\n        flattened.push({ ...action, children: undefined });\n        // Add children with parent prefix\n            if (Array.isArray(action.children)) {\n        action.children.forEach((child) => {\n                if (child) { // Skip null/undefined children\n          flattened.push({\n            ...child,\n            label: `${action.label} > ${child.label}`,\n            group: action.group || child.group,\n          });\n                }\n        });\n            }\n      } else {\n        flattened.push(action);\n      }\n    });\n      }\n      return flattened || [];\n    } catch (error) {\n      console.error(\"[CommandPalette] Error flattening actions:\", error);\n      return [];\n    }\n  }, []);\n\n  const groupedActions = React.useMemo(() => {\n    try {\n    if (!safeActions || !Array.isArray(safeActions) || safeActions.length === 0) {\n      return {};\n    }\n    const flattened = flattenActions(safeActions);\n      if (!flattened || !Array.isArray(flattened) || flattened.length === 0) {\n        return {};\n      }\n    const groups: Record<string, CommandPaletteAction[]> = {};\n      if (Array.isArray(flattened)) {\n    flattened.forEach((action) => {\n          if (!action) return; // Skip null/undefined actions\n      const group = action.group || \"General\";\n      if (!groups[group]) {\n        groups[group] = [];\n      }\n      groups[group].push(action);\n    });\n      }\n    return groups;\n    } catch (error) {\n      console.error(\"[CommandPalette] Error grouping actions:\", error);\n      return {};\n    }\n  }, [safeActions, flattenActions]);\n\n  // Get recent command actions\n  const recentCommandActions = React.useMemo(() => {\n    if (!showRecentCommands || recentCommands.length === 0 || !safeActions || !Array.isArray(safeActions) || safeActions.length === 0) return [];\n    const flattened = flattenActions(safeActions);\n    if (!flattened || !Array.isArray(flattened) || flattened.length === 0) return [];\n    const allActionsMap = new Map(flattened.map((a) => [a.id, a]));\n    return recentCommands\n      .map((id) => allActionsMap.get(id))\n      .filter((action): action is CommandPaletteAction => action !== undefined);\n  }, [safeActions, recentCommands, showRecentCommands, flattenActions]);\n\n  return (\n    <>\n      {trigger ? (\n        <div onClick={() => setOpen(true)}>{trigger}</div>\n      ) : (\n        <Button\n          variant=\"outline\"\n          onClick={() => setOpen(true)}\n          className=\"w-full justify-between\"\n        >\n          Search...{\" \"}\n          <span className=\"text-xs text-[color:var(--color-fg-muted)]\">\n            âŒ˜K\n          </span>\n        </Button>\n      )}\n      <CommandDialog open={open} onOpenChange={setOpen}>\n        <CommandInput placeholder={placeholder} />\n        <CommandList>\n          <CommandEmpty>{emptyText}</CommandEmpty>\n          {showRecentCommands && recentCommandActions.length > 0 && (\n            <CommandGroup heading=\"Recent\">\n              {recentCommandActions.map((action) => (\n                <CommandItem\n                  key={action.id}\n                  value={`${action.label} ${action.keywords?.join(\" \") || \"\"}`}\n                  onSelect={() => {\n                    action.onSelect?.();\n                    saveRecentCommand(action.id);\n                    setOpen(false);\n                  }}\n                >\n                  {action.icon}\n                  <span>{action.label}</span>\n                  {action.shortcut && (\n                    <CommandShortcut>{action.shortcut}</CommandShortcut>\n                  )}\n                </CommandItem>\n              ))}\n              <CommandSeparator />\n            </CommandGroup>\n          )}\n          {Object.entries(groupedActions).map(([groupName, groupActions]) => (\n            <CommandGroup key={groupName} heading={groupName}>\n              {groupActions.map((action) => (\n                <CommandItem\n                  key={action.id}\n                  value={`${action.label} ${action.keywords?.join(\" \") || \"\"}`}\n                  onSelect={() => {\n                    action.onSelect?.();\n                    saveRecentCommand(action.id);\n                    setOpen(false);\n                  }}\n                >\n                  {action.icon}\n                  <span>{action.label}</span>\n                  {action.shortcut && (\n                    <CommandShortcut>{action.shortcut}</CommandShortcut>\n                  )}\n                </CommandItem>\n              ))}\n            </CommandGroup>\n          ))}\n        </CommandList>\n      </CommandDialog>\n    </>\n  );\n}\n\n\n"
    }
  ]
}